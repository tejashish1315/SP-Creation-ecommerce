{% extends "base.html" %}
{% load static %}

{% block 'main' %}
<div class="container mt-4">

    <div class="row">
        <div class="col-md-9">
            <h4 class="bg-warning p-2">Your Cart</h4>

            {% if cart_items %}
                {% for item in cart_items %}
                    <div class="row mt-3 mb-4 border-bottom pb-3">
                        <div class="col-md-4">
                            <img src="{{ item.product.pimage.url }}" width="100%" height="300px" alt="{{ item.product.name }}" class="img-thumbnail">
                        </div>
                        <div class="col-md-8">
                            <p><strong>Product Name:</strong> {{ item.product.name }}</p>

                            {% if item.product.offer_price %}
                                <p><strong>Price:</strong>
                                    <del>₹{{ item.product.price }}</del>
                                    <span class="text-success">₹{{ item.product.offer_price }}</span>
                                </p>
                                <p><strong>You Save:</strong> ₹{{ item.you_save|floatformat:2 }}</p>
                            {% else %}
                                <p><strong>Price:</strong> ₹{{ item.product.price }}</p>
                            {% endif %}

                            <p><strong>Subtotal:</strong> ₹{{ item.subtotal|floatformat:2 }}</p>
                            <p><strong>Category:</strong> {{ item.product.cat }}</p>
                            <p><strong>Description:</strong> {{ item.product.pdetails }}</p>

                            <!-- Quantity Controls -->
                            <form method="POST" action="{% url 'update_cart_quantity' item.id %}" class="d-inline-block">
                                {% csrf_token %}
                                <div class="input-group" style="width: 150px;">
                                    <button type="submit" name="action" value="decrease" class="btn btn-outline-secondary btn-sm">-</button>
                                    <input type="text" name="quantity" value="{{ item.quantity }}" class="form-control text-center" readonly>
                                    <button type="submit" name="action" value="increase" class="btn btn-outline-secondary btn-sm">+</button>
                                </div>
                            </form>

                            <!-- Remove Item -->
                            <a href="{% url 'remove_from_cart' item.id %}" class="btn btn-danger btn-sm ms-2">Remove</a>
                        </div>
                    </div>
                {% endfor %}

                <!-- Cart Summary -->
                <h4 class="mt-4">Total Amount: ₹{{ total|floatformat:2 }}</h4>
                <div class="mb-3">
                    <a href="{% url 'clear_cart' %}" class="btn btn-danger">Remove All</a>
                    <a href="{% url 'place_order' %}" class="btn btn-success ms-2">Place Order</a>
                </div>

            {% else %}
                <p class="mt-3">Your cart is empty.</p>
            {% endif %}
        </div>

        <!-- Customer Info Sidebar -->
        <div class="col-md-3">
            <h5 class="bg-warning p-2">Customer Details</h5>
            <p><strong>Name:</strong> {{ request.user.get_full_name }}</p>
            <p><strong>Mobile:</strong> {{ request.user.profile.mobile|default:"Not provided" }}</p>
            <p><strong>Email:</strong> {{ request.user.email }}</p>
        </div>
    </div>
</div>
{% endblock 'main' %}
